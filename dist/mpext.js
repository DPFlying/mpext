let t=null;function e(){return t}function n(e){t=e}const o=t=>"[object Object]"===Object.prototype.toString.call(t),a=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),c=t=>"function"==typeof t;function s(t){if(!o(t))throw new TypeError(`${t}不是一个对象`);const n=e();if(!n)return{};const{storeName:s="$store",mapState:r,mapDispatch:l}=t;let i=null;if(Array.isArray(r)&&r.length>0){const t=n.getState();(i=r.filter(e=>a(t,e))).length<1&&(i=null)}const u=!!i;let h=!1,p={};return o(l)&&Object.keys(l).forEach(t=>{const e=l[t];c(e)&&(h=!0,p[t]=e)}),h||(p=null),{storeName:s,hasMapState:u,ownStateKeys:i,hasMapDispatch:h,ownActionCreators:p}}function r(t,n){const o=e().getState();this.setData({[n]:t.reduce((t,e)=>(t[e]=o[e],t),{})})}function l(t,n){const o=e();let a=o.getState();return o.subscribe(()=>{let e=!1;const c=o.getState(),s=t.reduce((t,o)=>(c[o]!==a[o]&&(e=!0,t[`${n}.${o}`]=c[o]),t),{});e&&this.setData(s),a=c})}function i(t){const{dispatch:n}=e();return Object.keys(t).reduce((e,o)=>{const a=t[o];return e[o]=(...t)=>n(a(...t)),e},{})}function u(t={}){const{storeName:n,hasMapState:o,ownStateKeys:a,hasMapDispatch:u,ownActionCreators:h}=s(t);return function(t){const{onLoad:s,onUnload:p}=t,f=!!e();let d=null;return t.onLoad=function(t){f&&o&&(r.call(this,a,n),d=l.call(this,a,n)),s&&s.call(this,t)},t.onUnload=function(){p&&p.call(this),c(d)&&(d(),d=null)},f&&u&&Object.assign(t,i(h)),Page(t)}}function h(t={}){const{storeName:n,hasMapState:o,ownStateKeys:a,hasMapDispatch:u,ownActionCreators:h}=s(t);return function(t){const{attached:s,detached:p}=t,f=!!e();let d=null;return t.attached=function(){f&&o&&(r.call(this,a,n),d=l.call(this,a,n)),s&&s.call(this)},t.detached=function(){p&&p.call(this),c(d)&&(d(),d=null)},t.methods||(t.methods={}),f&&u&&Object.assign(t.methods,i(h)),Component(t)}}export{h as $component,u as $page,e as getStore,n as setStore};
