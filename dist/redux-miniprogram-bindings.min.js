const t=wx,e={page:["onLoad","onUnload"],component:["attached","detached"]},n=t=>"function"==typeof t,o=Array.isArray,c=Object.prototype.toString,s=t=>"[object Object]"===c.call(t),a=t=>c.call(t),r=Object.keys,i=t=>r(t).length<1,f=Object.prototype.hasOwnProperty,u=t=>{throw new Error(t)};function l(e){s(e)||u("provider必须是一个Object");const{store:n,namespace:o="",manual:c=!1}=e;n||u("store必须为Redux的Store实例对象"),t.$$provider={store:n,namespace:o,manual:c}}function p(){return t.$$provider||u("请先设置provider"),t.$$provider}const h=()=>p().store,g=()=>p().store.getState();function b(){const{store:t}=p();return t.dispatch.bind(t)}function d(t){const{store:e}=p();let n=e.getState();return e.subscribe(()=>{const o=e.getState();t(o,n),n=o})}function j(t){const{store:e}=p(),n={};return Object.defineProperty(n,"value",{configurable:!1,enumerable:!0,get:()=>t(e.getState())}),n}function O(t){const e=g(),n={};for(let o=0,c=t.length;o<c;o++){const c=t[o];switch(typeof c){case"string":f.call(e,c)&&(n[c]=e[c]);break;case"function":{const t=c(e);s(t)&&!i(t)&&Object.assign(n,t);break}}}return n}function y(t,e){s(t)?function(t,e){const o=b(),c=r(t);for(let s=0,a=c.length;s<a;s++){const a=c[s],r=t[a];n(r)&&(e[a]=(...t)=>o(r.apply(null,t)))}}(t,e):n(t)&&function(t,e){const n=t(b());s(n)||u("mapDispatch函数必须返回一个对象"),i(n)||Object.assign(e,n)}(t,e)}function m(t,e,n,o){const c=r(t),s=r(e),i=c.length,f=s.length;if(!(i<1&&f<1))if(i<1||f<1||i<f)n[o]=t;else{for(let e=0;e<f;e++){const a=s[e];if(c.indexOf(a)<0)return void(n[o]=t)}for(let r=0;r<i;r++){const i=c[r],f=t[i],u=`${o}.${i}`;if(s.indexOf(i)<0){n[u]=f;continue}const l=e[i];if(f!==l){const t=a(f);t!==a(l)?n[u]=f:"[object Object]"===t?m(f,l,n,u):"[object Array]"===t?$(f,l,n,u):n[u]=f}}}}function $(t,e,n,o){const c=t.length,s=e.length;if(!(c<1&&s<1))if(c<1||s<1||c<s)n[o]=t;else for(let r=0;r<c;r++){const c=t[r],i=`${o}[${r}]`;if(r>=s){n[i]=c;continue}const f=e[r];if(c!==f){const t=a(c);t!==a(f)?n[i]=c:"[object Object]"===t?m(c,f,n,i):"[object Array]"===t?$(c,f,n,i):n[i]=c}}}function A(t,e,n=""){const o=r(t),c=r(e),s=o.length,i=c.length;if(s<1&&i<1)return{};if(s<1||i<1)return n?{[n]:t}:t;const f={};for(let r=0;r<s;r++){const s=o[r],i=t[s],u=n?`${n}.${s}`:s;if(c.indexOf(s)<0){f[u]=i;continue}const l=e[s];if(i!==l){const t=a(i);t!==a(l)?f[u]=i:"[object Object]"===t?m(i,l,f,u):"[object Array]"===t?$(i,l,f,u):f[u]=i}}return f}var v=new class{constructor(){this.queue=[]}push(t,e){const n=this.queue;let o;for(let e=0,c=n.length;e<c;e++)if(n[e].thisArg===t){o=n[e];break}o||(o={thisArg:t,data:{}},n.push(o)),Object.assign(o.data,e),Promise.resolve().then(this.exec.bind(this))}exec(){if(this.queue.length<1)return;const t=this.queue;this.queue=[];const{namespace:e}=p();for(let n=0,o=t.length;n<o;n++){const o=t[n],c=A(o.data,e?o.thisArg.data[e]:o.thisArg.data,e);i(c)||(o.diffData=c)}let n;for(;n=t.shift();)n.diffData&&n.thisArg.setData(n.diffData)}};let x=0,w=0;function D({type:t="page",mapState:n,mapDispatch:c,manual:a}={}){"page"!==t&&"component"!==t&&u("type属性只能是page或component");const r="page"===t,{namespace:f,manual:l}=p();return"boolean"!=typeof a&&(a=l),function(u){if(u.$$type=t,o(n)&&n.length>0){const o=O(n),[c,a]=e[t],r=u[c],l=u[a];let p=null;u.data=Object.assign(u.data||{},f?{[f]:o}:o),u[c]=function(...t){const e=O(n);if(!i(e)){const t=A(e,f?this.data[f]:this.data,f);i(t)||this.setData(t)}p=function(t,e){x+=1;const n=d((n,o)=>{let c;for(let t=0,a=e.length;t<a;t++){const a=e[t];switch(typeof a){case"string":n[a]!==o[a]&&(c||(c={}),c[a]=n[a]);break;case"function":{const t=a(n);s(t)&&!i(t)&&(c||(c={}),Object.assign(c,t));break}}}c&&v.push(t,c),w+=1,w===x&&(w=0,v.exec())});return()=>{x-=1,n()}}(this,n),r&&r.apply(this,t)},u[a]=function(...t){l&&l.call(this,t),p&&(p(),p=null)}}if(c){const t=r?u:u.methods=u.methods||{};y(c,t)}return a?u:r?Page(u):Component(u)}}const S=(t={})=>D(Object.assign(Object.assign({},t),{type:"page"})),k=(t={})=>D(Object.assign(Object.assign({},t),{type:"component"}));export{k as $component,S as $page,D as connect,l as setProvider,b as useDispatch,j as useRef,g as useState,h as useStore,d as useSubscribe};
