const t=wx,e={page:["onLoad","onUnload"],component:["attached","detached"]},n=t=>"function"==typeof t,o=Array.isArray,s=Object.prototype.toString,c=t=>"[object Object]"===s.call(t),a=t=>s.call(t),i=Object.keys,r=t=>i(t).length<1,f=Object.prototype.hasOwnProperty,l=t=>{throw new Error(t)};function u(e){c(e)||l("provider必须是一个Object");const{store:n,namespace:o="",manual:s=!1}=e;n||l("store必须为Redux的Store实例对象"),t.$$provider={store:n,namespace:o,manual:s}}function h(){return t.$$provider||l("请先设置provider"),t.$$provider}const p=()=>h().store,g=()=>h().store.getState(),b=()=>{const{store:t}=h();return t.dispatch.bind(t)},d=t=>{const{store:e}=h();let n=e.getState();return e.subscribe(()=>{const o=e.getState();t(o,n),n=o})};function j(t){const e=g(),n={};for(let o=0,s=t.length;o<s;o++){const s=t[o];switch(typeof s){case"string":f.call(e,s)&&(n[s]=e[s]);break;case"function":{const t=s(e);c(t)&&!r(t)&&Object.assign(n,t);break}}}return n}function O(t,e){c(t)?function(t,e){const o=b(),s=i(t);for(let c=0,a=s.length;c<a;c++){const a=s[c],i=t[a];n(i)&&(e[a]=(...t)=>o(i.apply(null,t)))}}(t,e):n(t)&&function(t,e){const n=t(b());c(n)||l("mapDispatch函数必须返回一个对象"),r(n)||Object.assign(e,n)}(t,e)}function y(t,e,n,o){const s=i(t),c=i(e),r=s.length,f=c.length;if(!(r<1&&f<1))if(r<1||f<1||r<f)n[o]=t;else{for(let e=0;e<f;e++){const a=c[e];if(s.indexOf(a)<0)return void(n[o]=t)}for(let i=0;i<r;i++){const r=s[i],f=t[r],l=`${o}.${r}`;if(c.indexOf(r)<0){n[l]=f;continue}const u=e[r];if(f!==u){const t=a(f);t!==a(u)?n[l]=f:"[object Object]"===t?y(f,u,n,l):"[object Array]"===t?m(f,u,n,l):n[l]=f}}}}function m(t,e,n,o){const s=t.length,c=e.length;if(!(s<1&&c<1))if(s<1||c<1||s<c)n[o]=t;else for(let i=0;i<s;i++){const s=t[i],r=`${o}[${i}]`;if(i>=c){n[r]=s;continue}const f=e[i];if(s!==f){const t=a(s);t!==a(f)?n[r]=s:"[object Object]"===t?y(s,f,n,r):"[object Array]"===t?m(s,f,n,r):n[r]=s}}}function $(t,e,n=""){const o=i(t),s=i(e),c=o.length,r=s.length;if(c<1&&r<1)return{};if(c<1||r<1)return n?{[n]:t}:t;const f={};for(let i=0;i<c;i++){const c=o[i],r=t[c],l=n?`${n}.${c}`:c;if(s.indexOf(c)<0){f[l]=r;continue}const u=e[c];if(r!==u){const t=a(r);t!==a(u)?f[l]=r:"[object Object]"===t?y(r,u,f,l):"[object Array]"===t?m(r,u,f,l):f[l]=r}}return f}var A=new class{constructor(){this.queue=[]}push(t,e){const n=this.queue;let o;for(let e=0,s=n.length;e<s;e++)if(n[e].thisArg===t){o=n[e];break}o||(o={thisArg:t,data:{}},n.push(o)),Object.assign(o.data,e),Promise.resolve().then(this.exec.bind(this))}exec(){if(this.queue.length<1)return;const t=this.queue;this.queue=[];const{namespace:e}=h();for(let n=0,o=t.length;n<o;n++){const o=t[n],s=$(o.data,e?o.thisArg.data[e]:o.thisArg.data,e);r(s)||(o.diffData=s)}let n;for(;n=t.shift();)n.diffData&&n.thisArg.setData(n.diffData)}};let x=0,v=0;function w({type:t="page",mapState:n,mapDispatch:s,manual:a}={}){"page"!==t&&"component"!==t&&l("type属性只能是page或component");const i="page"===t,{namespace:f,manual:u}=h();return"boolean"!=typeof a&&(a=u),function(l){if(l.$$type=t,o(n)&&n.length>0){const o=j(n),[s,a]=e[t],i=l[s],u=l[a];let h=null;l.data=Object.assign(l.data||{},f?{[f]:o}:o),l[s]=function(...t){const e=j(n);if(!r(e)){const t=$(e,f?this.data[f]:this.data,f);r(t)||this.setData(t)}h=function(t,e){x+=1;const n=d((n,o)=>{let s;for(let t=0,a=e.length;t<a;t++){const a=e[t];switch(typeof a){case"string":n[a]!==o[a]&&(s||(s={}),s[a]=n[a]);break;case"function":{const t=a(n);c(t)&&!r(t)&&(s||(s={}),Object.assign(s,t));break}}}s&&A.push(t,s),v+=1,v===x&&(v=0,A.exec())});return()=>{x-=1,n()}}(this,n),i&&i.apply(this,t)},l[a]=function(...t){u&&u.call(this,t),h&&(h(),h=null)}}if(s){const t=i?l:l.methods=l.methods||{};O(s,t)}return a?l:i?Page(l):Component(l)}}const D=(t={})=>w(Object.assign(Object.assign({},t),{type:"page"})),k=(t={})=>w(Object.assign(Object.assign({},t),{type:"component"}));export{k as $component,D as $page,w as connect,u as setProvider,b as useDispatch,g as useState,p as useStore,d as useSubscribe};
